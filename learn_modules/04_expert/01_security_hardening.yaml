id: security_hardening_01
level: expert
title: "Security & Hardening"
description: "Master security tools, SELinux, and system hardening"
estimated_time: 50

lessons:
  - id: lesson_01
    title: "SELinux Basics"
    notes: |
      ðŸ”’ SELinux - Security Enhanced Linux
      
      SELinux Modes:
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â€¢ Enforcing  - SELinux enforces policies
      â€¢ Permissive - SELinux logs but doesn't enforce
      â€¢ Disabled   - SELinux is off
      
      Commands:
      â”€â”€â”€â”€â”€â”€â”€â”€
      â€¢ getenforce            - Show current mode
      â€¢ setenforce 0          - Set permissive
      â€¢ setenforce 1          - Set enforcing
      â€¢ sestatus              - Detailed status
      
      Context Management:
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â€¢ ls -Z file            - Show SELinux context
      â€¢ ps -Z                 - Show process contexts
      â€¢ chcon -t httpd_sys_content_t file - Change context
      â€¢ restorecon file       - Restore default context
      â€¢ semanage fcontext -l  - List file contexts
      
      Booleans:
      â”€â”€â”€â”€â”€â”€â”€â”€
      â€¢ getsebool -a          - List all booleans
      â€¢ setsebool httpd_can_network_connect on
      â€¢ setsebool -P httpd_can_network_connect on (persistent)
      
      Troubleshooting:
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â€¢ ausearch -m avc       - Search audit logs
      â€¢ audit2why < /var/log/audit/audit.log
      â€¢ audit2allow -a        - Generate policy
    
    exercises:
      - id: ex_01
        type: command
        description: "Check SELinux status"
        command: getenforce 2>/dev/null || echo "SELinux not available"
        hints:
          - "Use: getenforce"
        points: 15
      
      - id: ex_02
        type: command
        description: "Show detailed SELinux status"
        command: sestatus 2>/dev/null || echo "SELinux not available"
        hints:
          - "Use: sestatus"
        points: 15

  - id: lesson_02
    title: "SSH Security"
    notes: |
      ðŸ”‘ SSH Configuration & Security
      
      SSH Key Management:
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â€¢ ssh-keygen            - Generate key pair
      â€¢ ssh-keygen -t rsa -b 4096
      â€¢ ssh-copy-id user@host - Copy public key
      â€¢ ssh-add ~/.ssh/id_rsa - Add key to agent
      
      SSH Config (/etc/ssh/sshd_config):
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â€¢ PermitRootLogin no
      â€¢ PasswordAuthentication no
      â€¢ PubkeyAuthentication yes
      â€¢ Port 2222
      â€¢ AllowUsers john jane
      â€¢ DenyUsers baduser
      
      SSH Client Config (~/.ssh/config):
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      Host myserver
          HostName 192.168.1.100
          User admin
          Port 2222
          IdentityFile ~/.ssh/id_rsa
      
      Hardening:
      â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â€¢ Disable root login
      â€¢ Use key-based auth only
      â€¢ Change default port
      â€¢ Use fail2ban for brute-force protection
      â€¢ Enable 2FA with Google Authenticator
    
    exercises:
      - id: ex_03
        type: command
        description: "Check if SSH service is running"
        command: systemctl is-active sshd || systemctl is-active ssh
        hints:
          - "Use: systemctl is-active sshd"
        points: 15

  - id: lesson_03
    title: "System Auditing"
    notes: |
      ðŸ“Š Audit & Logging
      
      journalctl - Systemd logs:
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â€¢ journalctl            - All logs
      â€¢ journalctl -u ssh     - Service logs
      â€¢ journalctl -f         - Follow logs
      â€¢ journalctl --since "1 hour ago"
      â€¢ journalctl -p err     - Errors only
      â€¢ journalctl -b         - Current boot
      â€¢ journalctl --disk-usage
      
      auditd - Linux auditing:
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â€¢ auditctl -l           - List rules
      â€¢ auditctl -w /etc/passwd -p wa -k passwd_changes
      â€¢ ausearch -k passwd_changes
      â€¢ aureport              - Summary report
      
      Log Files:
      â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â€¢ /var/log/syslog       - System logs
      â€¢ /var/log/auth.log     - Authentication
      â€¢ /var/log/secure       - Security (RHEL)
      â€¢ /var/log/messages     - General messages
      â€¢ /var/log/kern.log     - Kernel logs
      
      last/lastb:
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â€¢ last                  - Successful logins
      â€¢ lastb                 - Failed logins
      â€¢ last -n 10            - Last 10 logins
      â€¢ who                   - Currently logged in
      â€¢ w                     - Who + what they're doing
    
    exercises:
      - id: ex_04
        type: command
        description: "Show last 5 system logins"
        command: last -n 5
        hints:
          - "Use: last -n 5"
        points: 15
      
      - id: ex_05
        type: command
        description: "Show SSH service logs from last hour"
        command: journalctl -u sshd --since "1 hour ago" 2>/dev/null || journalctl -u ssh --since "1 hour ago" 2>/dev/null || echo "No logs"
        hints:
          - "Use: journalctl -u sshd --since \"1 hour ago\""
        points: 20

completion_criteria:
  min_exercises_completed: 4
  min_score: 65
